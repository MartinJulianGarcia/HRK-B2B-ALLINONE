<div class="profile-container">
  <!-- Header con navegaci√≥n -->
  <div class="profile-header">
    <button class="back-btn" (click)="goBack()" title="Volver">
      ‚Üê
    </button>
    <h1 class="page-title">Mi Perfil</h1>
  </div>

  <!-- Separador -->
  <div class="separator"></div>

  <!-- Contenido principal -->
  <div class="profile-content">
    <!-- Tarjeta superior: Resumen del perfil y acciones -->
    <div class="profile-card">
      <div class="profile-info">
        <div class="profile-icon">
          <div class="user-avatar">
            <img src="/images/profile/default-user.png" alt="Usuario" class="avatar-image">
          </div>
        </div>
        <div class="user-details">
          <h2 class="user-name">{{ user?.nombreRazonSocial || 'Usuario' }}</h2>
          <p class="user-email">{{ user?.email || 'email@ejemplo.com' }}</p>
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-primary" (click)="editProfile()" *ngIf="!editando">
          Editar Perfil
        </button>
        <button class="btn btn-secondary" (click)="viewOrderHistory()" *ngIf="!editando">
          Ver Historial de Pedidos
        </button>
        <button class="btn btn-dashboard" (click)="goToDashboards()" *ngIf="!editando && authService.isAdmin()">
          <span class="btn-text">Ver m√©tricas del negocio</span>
          <span class="icon-chart">üìä</span>
        </button>
        <button class="btn btn-dashboard" (click)="goToManageProducts()" *ngIf="!editando && authService.isAdmin()">
          <span class="btn-text">Gestionar art√≠culos</span>
          <span class="icon-manage">üëó</span>
        </button>
        <button class="btn btn-outline" (click)="logout()" *ngIf="!editando">
          Cerrar Sesi√≥n
        </button>
      </div>
    </div>

    <!-- Tarjeta inferior: Informaci√≥n de la cuenta -->
    <div class="info-card">
      <h3 class="card-title">Informaci√≥n de la cuenta</h3>
      
      <!-- Modo visualizaci√≥n -->
      <ng-container *ngIf="!editando">
        <div class="info-row">
          <span class="info-label">Usuario:</span>
          <span class="info-value">{{ user?.nombreRazonSocial || 'N/A' }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Email:</span>
          <span class="info-value">{{ user?.email || 'N/A' }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Miembro desde:</span>
          <span class="info-value">{{ memberSince }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Rol actual:</span>
          <span class="info-value">{{ user?.tipoUsuario || 'N/A' }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">CUIT:</span>
          <span class="info-value">{{ user?.cuit || 'N/A' }}</span>
        </div>
        <div class="info-row" *ngIf="authService.isAdmin()">
          <label class="info-label">Ver productos ocultos en el cat√°logo:</label>
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [checked]="verProductosOcultos"
              (change)="toggleVerProductosOcultos($event)"
            >
            <span>Ver productos ocultos</span>
          </label>
        </div>
        <div class="info-row" *ngIf="!editando && mostrarBotonCambioRol">
          <button class="btn btn-secondary" (click)="cambiarRol()">
            Cambiar a {{ user?.tipoUsuario === 'CLIENTE' ? 'ADMIN' : 'CLIENTE' }}
          </button>
        </div>
      </ng-container>

      <!-- Modo edici√≥n -->
      <ng-container *ngIf="editando">
        <div class="edit-form">
          <div class="form-group">
            <label for="nombreRazonSocial" class="form-label">Nombre / Raz√≥n Social:</label>
            <input 
              type="text" 
              id="nombreRazonSocial" 
              name="nombreRazonSocial" 
              [(ngModel)]="editForm.nombreRazonSocial" 
              class="form-control"
              required
              [disabled]="guardando"
            >
          </div>

          <div class="form-group">
            <label for="cuit" class="form-label">CUIT:</label>
            <input 
              type="text" 
              id="cuit" 
              name="cuit" 
              [(ngModel)]="editForm.cuit" 
              class="form-control"
              required
              [disabled]="guardando"
            >
          </div>

          <div class="form-group">
            <label class="form-label">Email:</label>
            <input 
              type="email" 
              [value]="user?.email || ''" 
              class="form-control"
              disabled
            >
            <small class="form-text">El email no se puede modificar</small>
          </div>

          <div *ngIf="error" class="error-message">
            {{ error }}
          </div>

          <div class="form-actions">
            <button 
              class="btn btn-primary" 
              (click)="guardarCambios()" 
              [disabled]="guardando"
            >
              <span *ngIf="!guardando">Guardar Cambios</span>
              <span *ngIf="guardando">Guardando...</span>
            </button>
            <button 
              class="btn btn-outline" 
              (click)="cancelarEdicion()" 
              [disabled]="guardando"
            >
              Cancelar
            </button>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<!-- Modal de c√≥digo de validaci√≥n para cambio a ADMIN -->
<div class="modal-overlay" *ngIf="mostrarModalCodigo" (click)="cerrarModalCodigo()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>C√≥digo de Validaci√≥n</h3>
      <button class="modal-close" (click)="cerrarModalCodigo()" title="Cerrar">√ó</button>
    </div>
    <div class="modal-body">
      <p>Para cambiar tu rol a <strong>ADMIN</strong>, ingresa el c√≥digo de validaci√≥n:</p>
      <div class="form-group">
        <input 
          type="text" 
          class="form-control" 
          [(ngModel)]="codigoValidacion"
          placeholder="Ingresa el c√≥digo"
          (keyup.enter)="validarYCambiarRol()"
          autofocus
        >
        <div *ngIf="errorCodigo" class="error-message">
          {{ errorCodigo }}
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" (click)="validarYCambiarRol()">
        Validar
      </button>
      <button class="btn btn-outline" (click)="cerrarModalCodigo()">
        Cancelar
      </button>
    </div>
  </div>
</div>
